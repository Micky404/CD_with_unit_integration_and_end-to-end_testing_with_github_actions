name: Feature to Dev CI

on:
  push:
    branches:
      - dev

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install dependencies for backend
      run: |
        cd backend
        npm install

    - name: Run backend unit tests
      run: |
        cd backend
        npm test

    - name: Install dependencies for frontend
      run: |
        cd frontend
        npm install

    - name: Run frontend unit tests
      run: |
        cd frontend
        npm test

    - name: Merge dev into main
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: dev
          branch: main
          commit-message: Merge dev into main
          title: Merge dev into main